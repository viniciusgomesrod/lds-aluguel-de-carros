<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Painel do agente AutoRent" />
    <meta name="author" content="AutoRent" />
    <title>AutoRent - Painel do Agente</title>

    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #e74c3c;
            --light: #ecf0f1;
        }

        body {
            font-family: 'Roboto Slab', sans-serif;
            color: var(--primary);
        }

        .navbar-dark {
            background-color: var(--primary) !important;
        }

        .agent-masthead {
            background-color: var(--light);
            padding: 10rem 0 5rem;
            text-align: center;
        }

        .agent-masthead .heading {
            font-family: 'Montserrat', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary);
        }

        .section-heading {
            color: var(--primary);
        }
        
        .card {
            transition: transform 0.3s, box-shadow 0.3s;
            border-radius: 10px;
            border: none;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background-color: var(--secondary);
            border-color: var(--secondary);
        }

        .btn-primary:hover {
            background-color: #c0392b;
            border-color: #c0392b;
        }
        
        .btn-success {
            background-color: #27ae60;
            border-color: #27ae60;
        }

        .btn-success:hover {
            background-color: #229954;
            border-color: #229954;
        }
        
        .btn-danger {
            background-color: #c0392b;
            border-color: #c0392b;
        }

        .btn-danger:hover {
            background-color: #a93226;
            border-color: #a93226;
        }

        .page-section {
            padding: 6rem 0;
        }

        .alert-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
        <div class="container">
            <a class="navbar-brand" th:href="@{/agente}">
                <h3>AutoRent - Agente</h3>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars ms-1"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav text-uppercase ms-auto py-4 py-lg-0">
                    <li class="nav-item"><a class="nav-link" href="#requests">Pedidos Pendentes</a></li>
                    <li class="nav-item"><a class="nav-link" href="#cars">Automóveis</a></li>
                    <li class="nav-item"><a class="nav-link" href="#reports">Relatórios</a></li>
                    <li class="nav-item">
                        <form th:action="@{/logout}" method="post" style="display: inline;">
                            <button type="submit" class="nav-link btn btn-link" style="border: none; background: none;">
                                Sair
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- Dashboard Masthead-->
    <header class="agent-masthead">
        <div class="container">
            <div class="heading text-uppercase">Painel do Agente AutoRent</div>
            <p class="text-muted mt-3">Gerencie pedidos e a frota de automóveis.</p>
        </div>
    </header>

    <!-- Alertas de Sucesso/Erro -->
    <div th:if="${param.success}" class="alert alert-success alert-dismissible fade show m-3" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${param.success}">Operação realizada com sucesso!</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div th:if="${param.error}" class="alert alert-danger alert-dismissible fade show m-3" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>
        <span th:text="${param.error}">Erro ao realizar operação!</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Pedidos Pendentes Section -->
    <section class="page-section" id="requests">
        <div class="container">
            <div class="text-center">
                <h2 class="section-heading text-uppercase">Pedidos Pendentes de Análise</h2>
                <h3 class="section-subheading text-muted">Revise os pedidos dos clientes.</h3>
            </div>
            <div class="d-flex justify-content-center mb-4">
                <div class="btn-group" role="group" aria-label="Filtros">
                    <button type="button" class="btn btn-outline-primary active" data-filter="pending">Pendentes</button>
                    <button type="button" class="btn btn-outline-success" data-filter="approved">Aprovados</button>
                    <button type="button" class="btn btn-outline-danger" data-filter="rejected">Rejeitados</button>
                </div>
            </div>
            <div class="row" id="request-list">
                <!-- Cartão de Pedido Pendente de Exemplo -->
                <div class="col-md-6 mb-4 request-card pending">
                    <div class="card p-3">
                        <h5>Pedido #10123</h5>
                        <p class="text-muted"><strong>Cliente:</strong> João Silva</p>
                        <p class="text-muted"><strong>Carro:</strong> Ford Fusion</p>
                        <p class="text-muted"><strong>Período:</strong> 01/10/2025 - 05/10/2025</p>
                        <p class="text-muted"><strong>Crédito:</strong> Sim</p>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#reviewModal" data-request-id="10123" data-request-status="pending">Analisar</button>
                        </div>
                    </div>
                </div>
                 <!-- Cartão de Pedido Aprovado de Exemplo -->
                <div class="col-md-6 mb-4 request-card approved" style="display: none;">
                    <div class="card p-3">
                        <h5>Pedido #10124</h5>
                        <p class="text-muted"><strong>Cliente:</strong> Maria Souza</p>
                        <p class="text-muted"><strong>Carro:</strong> Jeep Renegade</p>
                        <p class="text-muted"><strong>Período:</strong> 02/10/2025 - 07/10/2025</p>
                        <p class="text-muted"><strong>Crédito:</strong> Não</p>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#reviewModal" data-request-id="10124" data-request-status="approved">Ver Detalhes</button>
                        </div>
                    </div>
                </div>
                 <!-- Cartão de Pedido Rejeitado de Exemplo -->
                <div class="col-md-6 mb-4 request-card rejected" style="display: none;">
                    <div class="card p-3">
                        <h5>Pedido #10125</h5>
                        <p class="text-muted"><strong>Cliente:</strong> Pedro Costa</p>
                        <p class="text-muted"><strong>Carro:</strong> Hyundai HB20</p>
                        <p class="text-muted"><strong>Período:</strong> 03/10/2025 - 08/10/2025</p>
                        <p class="text-muted"><strong>Crédito:</strong> Sim</p>
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#reviewModal" data-request-id="10125" data-request-status="rejected">Ver Detalhes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Seção de Automóveis -->
<section class="page-section bg-light" id="cars">
    <div class="container">
        <div class="text-center mb-4">
            <h2 class="section-heading text-uppercase">Frota de Automóveis</h2>
            <h3 class="section-subheading text-muted">Gerencie os veículos disponíveis para aluguel.</h3>
        </div>

        <!-- Botão de adicionar novo carro -->
        <div class="d-flex justify-content-end mb-3">
            <a th:href="@{/agente/automoveis/novo}" class="btn btn-success">
                <i class="fas fa-plus me-2"></i> Adicionar Novo Carro
            </a>
        </div>

        <!-- Mensagem quando não há automóveis -->
        <div th:if="${#lists.isEmpty(automoveis)}" class="alert alert-info text-center">
            <i class="fas fa-info-circle me-2"></i>
            Nenhum automóvel cadastrado. 
            <a th:href="@{/agente/automoveis/novo}" class="alert-link">Clique aqui para adicionar o primeiro automóvel.</a>
        </div>

            <!-- Tabela de automóveis -->
            <table th:if="${not #lists.isEmpty(automoveis)}" class="table table-striped table-hover rounded overflow-hidden">
                <thead class="bg-primary text-light">
                    <tr>
                        <th scope="col">Placa</th>
                        <th scope="col">Marca</th>
                        <th scope="col">Modelo</th>
                        <th scope="col">Ano</th>
                        <th scope="col">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="automovel : ${automoveis}">
                        <td th:text="${automovel.placa}">ABC-1234</td>
                        <td th:text="${automovel.marca}">Ford</td>
                        <td th:text="${automovel.modelo}">Fusion</td>
                        <td th:text="${automovel.ano}">2023</td>
                        <td>
                            <!-- Botão Editar -->
                            <a th:href="@{'/agente/automoveis/editar/' + ${automovel.id}}" 
                            class="btn btn-sm btn-info me-2" 
                            title="Editar automóvel">
                                <i class="fas fa-edit"></i>
                            </a>
                            <!-- Botão Deletar -->
                            <a th:href="@{'/agente/automoveis/deletar/' + ${automovel.id}}" 
                            class="btn btn-sm btn-danger" 
                            title="Excluir automóvel"
                            onclick="return confirm('Tem certeza que deseja excluir este automóvel?')">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    
    <!-- Seção de Relatórios -->
    <section class="page-section" id="reports">
        <div class="container">
            <div class="text-center">
                <h2 class="section-heading text-uppercase">Relatórios de Análise</h2>
                <h3 class="section-subheading text-muted">Acompanhe o desempenho da equipe.</h3>
            </div>
            <div class="row text-center">
                <div class="col-lg-4">
                    <div class="card p-4">
                        <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                        <h5>Pedidos Aprovados</h5>
                        <p class="lead">56</p>
                    </div>
                </div>
                <div class="col-lg-4">
                     <div class="card p-4">
                        <i class="fas fa-times-circle fa-4x text-danger mb-3"></i>
                        <h5>Pedidos Rejeitados</h5>
                        <p class="lead">12</p>
                    </div>
                </div>
                <div class="col-lg-4">
                     <div class="card p-4">
                        <i class="fas fa-clock fa-4x text-info mb-3"></i>
                        <h5>Pedidos Pendentes</h5>
                        <p class="lead">8</p>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <button class="btn btn-primary" onclick="alert('Funcionalidade de exportar relatórios não implementada.')">
                        <i class="fas fa-download me-2"></i> Exportar Relatório
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer-->
    <footer class="footer py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-4 text-lg-start">Copyright &copy; AutoRent 2023</div>
                <div class="col-lg-4 my-3 my-lg-0">
                    <a class="btn btn-dark btn-social mx-2" href="#!" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a class="btn btn-dark btn-social mx-2" href="#!" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a class="btn btn-dark btn-social mx-2" href="#!" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                </div>
                <div class="col-lg-4 text-lg-end">
                    <a class="link-dark text-decoration-none me-3" href="#!">Política de Privacidade</a>
                    <a class="link-dark text-decoration-none" href="#!">Termos de Uso</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- MODAL: Tela de Análise de Pedido -->
    <div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reviewModalLabel">Analisar Pedido #<span id="requestId"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Detalhes do Cliente</h6>
                    <ul class="list-group list-group-flush mb-3">
                        <li class="list-group-item"><strong>Nome:</strong> João Silva</li>
                        <li class="list-group-item"><strong>Email:</strong> joao.silva@email.com</li>
                        <li class="list-group-item"><strong>Telefone:</strong> (11) 99999-9999</li>
                        <li class="list-group-item"><strong>Documentos:</strong> <a href="#">Ver Anexos</a></li>
                    </ul>
                     <h6>Detalhes do Pedido</h6>
                    <ul class="list-group list-group-flush mb-4">
                        <li class="list-group-item"><strong>Carro:</strong> Ford Fusion</li>
                        <li class="list-group-item"><strong>Período:</strong> 01/10/2025 - 05/10/2025</li>
                        <li class="list-group-item"><strong>Local:</strong> São Paulo</li>
                        <li class="list-group-item"><strong>Contrato de Crédito:</strong> Sim</li>
                    </ul>
                </div>
                <div class="modal-footer" id="reviewActions">
                    <!-- Botões dinâmicos de aprovar/rejeitar -->
                    <button type="button" class="btn btn-success me-2" onclick="confirmAction('Deseja realmente aprovar este pedido?', 'processRequest(\'aprovado\')')">
                        <i class="fas fa-check-circle me-1"></i> Aprovar
                    </button>
                    <button type="button" class="btn btn-danger" onclick="confirmAction('Deseja realmente rejeitar este pedido?', 'processRequest(\'rejeitado\')')">
                        <i class="fas fa-times-circle me-1"></i> Rejeitar
                    </button>
                    <button type="button" class="btn btn-info" onclick="alert('Funcionalidade de edição não implementada.')">
                        <i class="fas fa-edit me-1"></i> Editar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Confirmação Customizada (substitui alert/confirm) -->
    <div class="modal fade" id="customConfirmModal" tabindex="-1" aria-labelledby="customConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customConfirmModalLabel">Confirmação</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="customConfirmMessage"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>
                    <button type="button" class="btn btn-primary" id="customConfirmYes">Sim</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JS e scripts de lógica -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Funções para Modais de Confirmação (substituem alert/confirm)
        function confirmAction(message, action) {
            var modal = new bootstrap.Modal(document.getElementById('customConfirmModal'));
            document.getElementById('customConfirmMessage').innerHTML = message;
            document.getElementById('customConfirmYes').onclick = function() {
                modal.hide();
                eval(action); // Executa a ação confirmada
            };
            modal.show();
        }

        function processRequest(status) {
            console.log("Pedido processado com status: " + status);
            var modal = bootstrap.Modal.getInstance(document.getElementById('reviewModal'));
            modal.hide();
            // Lógica para atualizar a lista de pedidos aqui
        }

        // Lógica do Modal de Análise de Pedido
        var reviewModal = document.getElementById('reviewModal');
        reviewModal.addEventListener('show.bs.modal', function(event) {
            var button = event.relatedTarget;
            var requestId = button.getAttribute('data-request-id');
            var requestStatus = button.getAttribute('data-request-status');
            
            this.querySelector('#requestId').textContent = requestId;
            var reviewActions = this.querySelector('#reviewActions');
            
            // Oculta/mostra botões com base no status do pedido
            if (requestStatus === 'pending') {
                reviewActions.style.display = 'block';
            } else {
                reviewActions.style.display = 'none';
            }
        });

        // Lógica para filtrar a listagem de pedidos
        var filterButtons = document.querySelectorAll('.btn-group button[data-filter]');
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Atualiza o estado dos botões de filtro
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                var filter = this.getAttribute('data-filter');
                var requestCards = document.querySelectorAll('.request-card');
                
                requestCards.forEach(card => {
                    if (filter === 'all' || card.classList.contains(filter)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });
    </script>
</body>
</html>